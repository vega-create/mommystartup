---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="åª½å’ªç²¾é¸å¥½ç‰©" description="åš´é¸å¥½ç‰©ï¼Œè®“åª½åª½ç”Ÿæ´»æ›´è¼•é¬†">
  <section class="section">
    <h2 class="section-title">åª½å’ªç²¾é¸å¥½ç‰©</h2>
    <p style="text-align: center; color: var(--text-light); margin-bottom: 40px; max-width: 600px; margin-left: auto; margin-right: auto;">
      æ¯ä¸€æ¨£å•†å“éƒ½æ˜¯æˆ‘å€‘è¦ªè‡ªè©¦ç”¨ã€çœŸå¿ƒæ¨è–¦çš„å¥½ç‰©ã€‚<br>
      è®“ç”Ÿæ´»å¤šä¸€é»è¼•é¬†ï¼Œå°‘ä¸€é»ç…©æƒ± ğŸ’•
    </p>
    
    <div class="shop-grid" id="shopGrid">
      <div class="shop-loading">è¼‰å…¥ä¸­...</div>
    </div>
    
    <div id="shopEmpty" style="display:none; text-align:center; padding:60px 20px; color:var(--text-light);">
      <p style="font-size:48px; margin-bottom:16px;">ğŸ›ï¸</p>
      <p>ç²¾é¸å¥½ç‰©å³å°‡ä¸Šæ¶ï¼Œæ•¬è«‹æœŸå¾…ï¼</p>
    </div>
  </section>
</Layout>

<style>
  .shop-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 30px;
    max-width: 1200px;
    margin: 0 auto;
  }
  .shop-loading {
    grid-column: 1 / -1;
    text-align: center;
    padding: 60px;
    color: var(--text-light);
  }
  .shop-card {
    background: white;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    transition: transform 0.3s, box-shadow 0.3s;
  }
  .shop-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.1);
  }
  .shop-card-image {
    position: relative;
    aspect-ratio: 4/3;
    overflow: hidden;
  }
  .shop-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
  }
  .shop-card:hover .shop-card-image img {
    transform: scale(1.05);
  }
  .shop-card-image .no-image {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primary-light), var(--primary));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
  }
  .shop-card-tag {
    position: absolute;
    top: 12px;
    left: 12px;
    background: var(--primary);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
  }
  .shop-card-content {
    padding: 20px;
  }
  .shop-card-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 8px;
  }
  .shop-card-desc {
    font-size: 14px;
    color: var(--text-light);
    line-height: 1.6;
    margin-bottom: 16px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .shop-card-price {
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .shop-price-current {
    font-size: 20px;
    font-weight: 700;
    color: var(--primary-dark);
  }
  .shop-price-original {
    font-size: 14px;
    color: #aaa;
    text-decoration: line-through;
  }
  .shop-card-btn {
    display: block;
    text-align: center;
    padding: 10px;
    background: var(--primary);
    color: white;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    transition: background 0.2s;
  }
  .shop-card-btn:hover {
    background: var(--primary-dark);
  }
  @media (max-width: 768px) {
    .shop-grid { grid-template-columns: 1fr; padding: 0 16px; }
  }
  @media (min-width: 769px) and (max-width: 1024px) {
    .shop-grid { grid-template-columns: repeat(2, 1fr); }
  }
</style>

<script is:inline>
  const SUPABASE_URL = 'https://lexcvcinmphkmavgswgn.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxleGN2Y2lubXBoa21hdmdzd2duIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDEwODksImV4cCI6MjA4MjY3NzA4OX0.Ur2XPKbWU0Bfm87otq4uM_33cyWRi267nBbAEZtjcis';
  const SITE_ID = '156d8963-e892-4e62-a19d-8a3727814858';
  
  const script = document.createElement('script');
  script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js';
  script.onload = async () => {
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    
    const { data, error } = await sb
      .from('products')
      .select('*')
      .eq('site_id', SITE_ID)
      .eq('is_active', true)
      .order('sort_order', { ascending: true });
    
    const grid = document.getElementById('shopGrid');
    const empty = document.getElementById('shopEmpty');
    
    if (error || !data || data.length === 0) {
      grid.style.display = 'none';
      empty.style.display = '';
      return;
    }
    
    grid.innerHTML = data.map(p => `
      <div class="shop-card">
        <div class="shop-card-image">
          ${p.image 
            ? `<img src="${p.image}" alt="${p.name}" loading="lazy">` 
            : '<div class="no-image">ğŸ›ï¸</div>'}
          ${p.tag ? `<span class="shop-card-tag">${p.tag}</span>` : ''}
        </div>
        <div class="shop-card-content">
          <h3 class="shop-card-title">${p.name}</h3>
          <p class="shop-card-desc">${p.description || ''}</p>
          <div class="shop-card-price">
            ${p.price ? `<span class="shop-price-current">NT$ ${p.price.toLocaleString()}</span>` : ''}
            ${p.original_price ? `<span class="shop-price-original">NT$ ${p.original_price.toLocaleString()}</span>` : ''}
          </div>
          <a href="${p.link || '#'}" class="shop-card-btn" ${p.link && p.link !== '#' ? 'target="_blank"' : ''}>äº†è§£æ›´å¤š</a>
        </div>
      </div>
    `).join('');
  };
  document.head.appendChild(script);
</script>
